
$(document).ready(function() {
	$('.OphCoTherapyapplication_DecisionTree').delegate('.add_node', 'click', function(e) {
		var data = {};
		data['dt_id'] = $(this).attr('data-dt_id');
		if ($(this).attr('data-parent_id')) {
			data['parent_id'] = $(this).attr('data-parent_id');
		}
		
		$.ajax({
			'type': 'GET',
			//TODO: fix this URL to be generated by the code
			'url': '/OphCoTherapyapplication/admin/createDecisionTreeNode/' + data['dt_id'] + '?' + $.param(data),
			'success': function(data) {
				if (data.length > 0) {
					var popup = $("<div></div>");
					popup.html(data).dialog({
							height: 400,
							minHeight: 400,
							width: 700,
							title: 'Decision Tree Node',
							modal: true,
						}).dialog('open');
					
				}
			}
		});
		
		e.preventDefault();
	});
	
	$('.OphCoTherapyapplication_DecisionTree').delegate('.edit_node', 'click', function(e) {
		var node_id = $(this).attr('data-node_id');
		var url = '/OphCoTherapyapplication/admin/updateDecisionTreeNode/' + node_id;
		$('<iframe style="min-width: 95%"></iframe>').attr('src', url).dialog({
			height: 400,
			width: 700,
			title: 'Decision Tree Node',
			modal: true,
			close: function(ev, ui) { window.location.reload(); }
		}).dialog('open');
		
		e.preventDefault();
	});
	
	$('.OphCoTherapyapplication_DecisionTreeNode').delegate('.add_rule', 'click', function(e) {
		var node_id = $(this).attr('data-node_id');
		
		$.ajax({
			'type': 'GET',
			//TODO: fix this URL to be generated by the code
			'url': '/OphCoTherapyapplication/admin/createDecisionTreeNodeRule/' + node_id,
			'success': function(data) {
				if (data.length > 0) {
					var popup = $("<div></div>");
					popup.html(data).dialog({
							height: 400,
							minHeight: 400,
							width: 700,
							title: 'Decision Tree Node Rule',
							modal: true
						}).dialog('open');
					
				}
			}
		});
		
		e.preventDefault();
	});
	
});
